<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DrivingTrust Admin</title>
<style>
  body { font-family: Arial; padding:20px; }
  .car { padding:15px; border:1px solid #ddd; margin-bottom:15px; border-radius:5px; }
  .images img { width:120px; margin-right:8px; border-radius:4px; }
  .status-btn { padding:5px 10px; margin-right:5px; cursor:pointer; }
</style>
</head>
<body>

<h1>DrivingTrust Admin</h1>

<div id="cars"></div>

<script>
async function loadCars() {
  const res = await fetch("/api/getCars");
  const data = await res.json();

  const container = document.getElementById("cars");
  container.innerHTML = "";

  data.forEach(car => {
    const div = document.createElement("div");
    div.className = "car";

    div.innerHTML = `
      <h3>${car.car} (${car.status})</h3>
      <p><b>Name:</b> ${car.name}</p>
      <p><b>City:</b> ${car.city}</p>
      <p><b>Price:</b> ${car.price}</p>

      <button class="status-btn" onclick="setStatus(${car.id}, 'active')">Set Active</button>
      <button class="status-btn" onclick="setStatus(${car.id}, 'sold')">Set Sold</button>
      <button class="status-btn" onclick="setStatus(${car.id}, 'pending')">Set Pending</button>

      <h4>Upload Images:</h4>
      <input type="file" accept="image/*" onchange="uploadImage(event, ${car.id})">

      <div class="images">
        ${(car.images || []).map(img => `<img src="${img}">`).join("")}
      </div>
    `;

    container.appendChild(div);
  });
}

async function setStatus(id, status) {
  await fetch("/api/setStatus", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ id, status })
  });
  loadCars();
}

async function uploadImage(event, carId) {
  const file = event.target.files[0];
  const reader = new FileReader();
  reader.onloadend = async () => {
    await fetch("/api/uploadImage", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        base64: reader.result,
        carId
      })
    });
    loadCars();
  };
  reader.readAsDataURL(file);
}

loadCars();
</script>

</body>
</html>
